var flappy_bird;!function(t){var e=function(e){function i(){e.call(this),this.speed=2,this.addEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this)}__extends(i,e);var r=(__define,i),s=r.prototype;return s.onAddToStage=function(e){this.removeEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this),this.stageW=this.stage.stageWidth,this.stageH=this.stage.stageHeight;var i=RES.getRes("fence_png");this.textureWidth=i.textureWidth;var r=i.textureHeight;this.rowCount=Math.ceil(this.stageW/this.textureWidth)+1,this.bmpArr=[];for(var s=0;s<this.rowCount;s++){var h=t.createBitmapByName("fence_png");h.x=this.textureWidth*s-(this.textureWidth*this.rowCount-this.stageW),h.y=this.stageH-r,this.bmpArr.push(h),this.addChild(h)}},s.start=function(){this.removeEventListener(egret.Event.ENTER_FRAME,this.enterFrameHandler,this),this.addEventListener(egret.Event.ENTER_FRAME,this.enterFrameHandler,this)},s.enterFrameHandler=function(t){for(var e=0;e<this.rowCount;e++){var i=this.bmpArr[e];i.x-=this.speed,i.x<=-this.textureWidth&&(this.bmpArr.shift(),i.x=this.bmpArr[this.bmpArr.length-1].x+this.textureWidth,this.bmpArr.push(i))}},s.pause=function(){this.removeEventListener(egret.Event.ENTER_FRAME,this.enterFrameHandler,this)},i}(egret.DisplayObjectContainer);t.BgMap=e,egret.registerClass(e,"flappy_bird.BgMap")}(flappy_bird||(flappy_bird={}));var flappy_bird;!function(t){var e=function(t){function e(e){t.call(this),this.isFall=!0,this.texture=RES.getRes(e),this.width=.5*this.texture.textureWidth,this.height=.5*this.texture.textureHeight}__extends(e,t);var i=(__define,e);i.prototype;return e}(egret.Bitmap);t.Bird=e,egret.registerClass(e,"flappy_bird.Bird")}(flappy_bird||(flappy_bird={}));var flappy_bird;!function(t){var e=function(t){function e(){t.call(this),this.textField=new egret.TextField,this.createView()}__extends(e,t);var i=(__define,e),r=i.prototype;return r.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},r.setProgress=function(t,e){this.textField.text="Loading..."+t+"/"+e},e}(egret.Sprite);t.LoadingUI=e,egret.registerClass(e,"flappy_bird.LoadingUI")}(flappy_bird||(flappy_bird={}));var flappy_bird;!function(t){var e=function(e){function i(){e.call(this),this.addEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this)}__extends(i,e);var r=(__define,i),s=r.prototype;return s.onAddToStage=function(e){this.loadingView=new t.LoadingUI,this.stage.addChild(this.loadingView),RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/default.res.json","resource/")},s.onConfigComplete=function(t){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),RES.loadGroup("preload")},s.onResourceLoadComplete=function(t){"preload"==t.groupName&&(this.stage.removeChild(this.loadingView),RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),this.createGameScene())},s.onItemLoadError=function(t){console.warn("Url:"+t.resItem.url+" has failed to load")},s.onResourceLoadError=function(t){console.warn("Group:"+t.groupName+" has failed to load"),this.onResourceLoadComplete(t)},s.onResourceProgress=function(t){"preload"==t.groupName&&this.loadingView.setProgress(t.itemsLoaded,t.itemsTotal)},s.createGameScene=function(){this.stageW=this.stage.stageWidth,this.stageH=this.stage.stageHeight;var t=this.createBitmapByName("BG_day_png");this.addChild(t),t.width=this.stageW,t.height=this.stageH,this.btnStart=this.createBitmapByName("instructions_png"),this.btnStart.x=(this.stageW-this.btnStart.width)/2,this.btnStart.y=(this.stageH-this.btnStart.height)/2,this.btnStart.touchEnabled=!0,this.btnStart.addEventListener(egret.TouchEvent.TOUCH_TAP,this.gameStart,this),this.addChild(this.btnStart)},s.createBitmapByName=function(t){var e=new egret.Bitmap,i=RES.getRes(t);return e.texture=i,e},s.gameStart=function(){this.removeChild(this.btnStart),this.bg=new t.BgMap,this.addChild(this.bg),this.bg.start(),this.bird=new t.Bird("birdie_png"),this.addChild(this.bird),this.bird.x=this.stageW/5,this.bird.y=this.stageH/2,this.wall=new t.WallMap,this.addChildAt(this.wall,1),this.touchEnabled=!0,this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.fly,this),this.addEventListener(egret.Event.ENTER_FRAME,this.fall,this)},s.fly=function(){this.bird.isFall=!1;var t=this.bird.y>0;if(t){this.removeEventListener(egret.Event.ENTER_FRAME,this.fall,this);var e=this.bird.y-30,i=egret.Tween.get(this.bird);i.to({x:this.bird.x,y:e},50)}this.bird.isFall=!0,this.addEventListener(egret.Event.ENTER_FRAME,this.fall,this)},s.fall=function(){var t=this.bird.y<this.stageH-this.bird.height;if(t&&this.bird.isFall){this.bird.rotation=0;var e=egret.Tween.get(this.bird),i=this.bird.y+3;e.to({x:this.bird.x,y:i},50)}},i}(egret.DisplayObjectContainer);t.Main=e,egret.registerClass(e,"flappy_bird.Main")}(flappy_bird||(flappy_bird={}));var flappy_bird;!function(t){function e(t){var e=new egret.Bitmap,i=RES.getRes(t);return e.texture=i,e}var i=function(){function t(){}var e=(__define,t);e.prototype;return t.hitTest=function(t,e){var i=t.getBounds(),r=e.getBounds();return i.x=t.x,i.y=t.y,r.x=e.x,r.y=e.y,i.intersects(r)},t}();t.GameUtil=i,egret.registerClass(i,"flappy_bird.GameUtil"),t.createBitmapByName=e}(flappy_bird||(flappy_bird={}));var flappy_bird;!function(t){var e=function(e){function i(){e.call(this),this.topWallArr=[],this.botWallArr=[],this.speed=2,this.addEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this)}__extends(i,e);var r=(__define,i),s=r.prototype;return s.onAddToStage=function(e){this.removeEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this),this.stageW=this.stage.stageWidth,this.stageH=this.stage.stageHeight;var i=RES.getRes("finger_png");this.textureWidth=i.textureWidth;var r=i.textureHeight;this.start();for(var s=Math.ceil(this.stageW/this.textureWidth/3)+1,h=0;s>h;h++){var a=Math.floor(9*Math.random()+1),n=75*this.stageH/100*a/10,o=75*this.stageH/100*(10-a)/10;n>this.textureWidth/146*996&&(n-=n-this.textureWidth/146*996,o+=n-this.textureWidth/146*996),o>this.textureWidth/146*996&&(n+=o-this.textureWidth/146*996,o-=o-this.textureWidth/146*996);var d=t.createBitmapByName("finger_png");d.height=.75*r,d.width=this.textureWidth,d.x=this.stageW+this.textureWidth*h*3,d.y=n,d.rotation=180,this.topWallArr.push(d),this.addChild(d);var l=t.createBitmapByName("finger_png");l.height=.75*r,l.width=this.textureWidth,l.x=d.x-2*d.width,l.y=this.stageH-o,this.botWallArr.push(l),this.addChild(l)}},s.start=function(){this.removeEventListener(egret.Event.ENTER_FRAME,this.enterFrameHandler,this),this.addEventListener(egret.Event.ENTER_FRAME,this.enterFrameHandler,this)},s.enterFrameHandler=function(t){for(var e=0;e<this.topWallArr.length;e++){var i=this.topWallArr[e],r=this.botWallArr[e];if(r.x-=3,i.x-=3,i.x<0-i.width){var s,h,a,n,o,d;o=this.stageW,d=this.stageH,n=o/7.5,h=Math.floor(9*Math.random()+1),s=75*d/100*h/10,a=75*d/100*(10-h)/10,s>n/146*996&&(s-=s-n/146*996,a+=s-n/146*996),a>n/146*996&&(s+=a-n/146*996,a-=a-n/146*996),i.x=this.topWallArr[this.topWallArr.length-1].x+3*i.width,r.x=this.botWallArr[this.botWallArr.length-1].x+3*r.width,i.y=s,r.y=d-a,this.botWallArr.shift(),this.topWallArr.shift(),this.botWallArr.push(r),this.topWallArr.push(i)}}},s.pause=function(){this.removeEventListener(egret.Event.ENTER_FRAME,this.enterFrameHandler,this)},i}(egret.DisplayObjectContainer);t.WallMap=e,egret.registerClass(e,"flappy_bird.WallMap")}(flappy_bird||(flappy_bird={}));